<div class="page-header">
  <h1><i class="fa fa-tasks"></i> Tests d'acceptance DDS</h1>
</div>

<div class="row">
  <div class="col-lg-3">
    <p>
    <button type="button" ng-disabled="pendingTests > 0" class="btn btn-default" ng-click="launchAll()">
      <span ng-if="pendingTests > 0">
        <i class="fa fa-spinner fa-spin"></i> Tests en cours...
      </span>
      <span ng-if="pendingTests === 0">
        Lancer tous les tests
      </span>
    </button>
  </p>
  </div>
  <div class="col-lg-9">
    <progressbar ng-if="tests" ng-class="{'progress-striped active': pendingTests}" max="tests.length" value="tests.length - pendingTests">
      {{ tests.length - pendingTests }} / {{ tests.length }}
    </progressbar>
  </div>
</div>

<div ng-if="errors">
  <p>Tests en erreur : {{ errors }}/{{ tests.length }}</p>
</div>

<div class="row">
  <div class="col-lg-12">
    <accordion close-others="false">
      <accordion-group ng-repeat="test in tests" is-open="test.open" ng-class="{'panel-success': test.status === 'ok', 'panel-danger': test.status === 'ko'}">
        <accordion-heading>
           {{ test.name }} <i class="pull-right fa" ng-class="{'fa-chevron-down': test.open, 'fa-chevron-right': !test.open}"></i>
        </accordion-heading>
        <p class="pull-right">
          <a class="btn btn-default btn-xs" href="{{ test._id }}/edit">Modifier ce test</a>
          <button type="button" class="btn btn-default btn-xs" ng-disabled="test.running" ng-click="launchSingle(test)">
            Relancer
          </button>
        </p>
        <p ng-if="test.description">{{ test.description }}</p>

        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Droit</th>
              <th>Valeur attendue</th>
              <th>Valeur obtenue</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="expectedDroit in test.droitsAttendus" ng-class="{'success': expectedDroit.status === 'ok', 'danger': expectedDroit.status === 'ko', 'info': expectedDroit.status === 'unknown'}">
              <td>{{ droits[expectedDroit.id].shortLabel }}</td>
              <td>{{ displayDroitValue(expectedDroit.expectedValue) }}</td>
              <td>{{ displayDroitValue(expectedDroit.actualValue) }}</td>
            </tr>
          </tbody>
        </table>
      </accordion-group>
    </accordion>
  </div>
</div>
