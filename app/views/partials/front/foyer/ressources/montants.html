<form method="post" name="form" novalidate ng-submit="submit(form)">
  <p>Veuillez entrer les montants des ressources sélectionnées (net perçu pour les salaires ou indemnités).</p>
  <div ng-repeat="individuRef in individuRefs" ng-if="individuRef.hasRessources">
    <h2 ng-if="1 < individuRefs.length">{{ individuRef.label }}</h2>
    <div class="table-responsive" ng-if="individuRef.hasRessourcesNonTns">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th style="width: 200px;"></th>
            <th ng-repeat="month in months">{{ month.label|uppercaseFirst }}</th>
            <th>De {{ debutAnnee }} à {{ finAnnee }}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="ressource in individuRef.ressources|filter: isRessourceNonTns" class="capture-{{ ressource.type.category }}">
            <td style="width: 200px; vertical-align: middle; color: black;">{{ ressource.type.label }}</td>
            <td ng-repeat="monthRessource in ressource.months">
              <span class="input-group">
                <input
                  type="number"
                  class="form-control text-right"
                  required
                  min="0"
                  select-on-focus
                  zero-to-empty
                  ng-model="monthRessource.montant"
                  ng-change="updateMontantAnnuel(ressource)">
                <span class="input-group-addon hidden-xs">€</span>
              </span>
              <span class="text-danger" ng-if="form.submitted && montantInvalide(monthRessource.montant)">
                Montant invalide
              </span>
            </td>
            <td>
              <span class="input-group">
                <input
                  type="number"
                  class="form-control text-right"
                  required
                  min="0"
                  select-on-focus
                  zero-to-empty
                  ng-model="ressource.montantAnnuel">
                <span class="input-group-addon hidden-xs">€</span>
              </span>
              <span class="text-danger" ng-if="form.submitted && montantInvalide(ressource.montantAnnuel)">
                Montant invalide
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-responsive" ng-if="individuRef.hasRessourcesMicroTns">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th style="width: 200px;"></th>
            <th>Type de structure</th>
            <th>Type d'activité</th>
            <th>Chiffre d’affaires {{ yearMoinsUn }}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="ressource in individuRef.ressources|filter: isRessourceMicroTns" class="capture-tns">
            <td style="width: 200px; vertical-align: middle; color: black;">{{ ressource.type.label }}</td>
            <td style="width: 190px;">
              <select class="form-control" ng-model="ressource.tnsStructureType">
                <option value="auto_entrepreneur">Auto-entrepreneur</option>
                <option value="micro_entreprise">Micro-entreprise</option>
              </select>
            </td>
            <td style="width: 250px;">
              <select class="form-control" ng-model="ressource.tnsActiviteType">
                <option value="achat_revente">Achat/revente ou fourniture de logement</option>
                <option value="bic">Activité commerciale ou artisanale (BIC)</option>
                <option value="bnc">Activité libérale et/ou intellectuelle (BNC)</option>
              </select>
            </td>
            <td>
              <span class="input-group">
                <input
                  type="number"
                  id="chiffre-affaires"
                  class="form-control text-right"
                  required
                  min="0"
                  select-on-focus
                  zero-to-empty
                  ng-model="ressource.montantAnnuel">
                <span class="input-group-addon hidden-xs">€</span>
              </span>
              <span class="text-danger" ng-if="form.submitted && montantInvalide(ressource.montantAnnuel)">
                Montant invalide
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-responsive" ng-if="individuRef.hasRessourcesOtherTns">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th style="width: 200px;"></th>
            <th>Revenus sur le dernier exercice clos</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="ressource in individuRef.ressources|filter: isRessourceOtherTns" class="capture-tns">
            <td style="width: 200px; vertical-align: middle; color: black;">{{ ressource.type.label }}</td>
            <td>
              <span class="input-group">
                <input
                  type="number"
                  id="chiffre-affaires"
                  class="form-control text-right"
                  required
                  min="0"
                  select-on-focus
                  zero-to-empty
                  ng-model="ressource.montantAnnuel">
                <span class="input-group-addon hidden-xs">€</span>
              </span>
              <span class="text-danger" ng-if="form.submitted && montantInvalide(ressource.montantAnnuel)">
                Montant invalide
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="text-right">
    <span class="text-danger" ng-if="form.submitted && form.$invalid">Veuillez entrer des montants valides</span>
    <button type="submit" class="btn btn-primary">Valider</button>
  </div>
</form>
