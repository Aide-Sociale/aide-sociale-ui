<form name="form" class="form-horizontal" novalidate ng-submit="submit(form)">
  <div class="modal-header">
    <h1 class="modal-title">Votre logement</h1>
  </div>

  <div class="modal-body">
    <p><em>
      Si vous n’avez pas de domicile fixe ou stable, vous devez effectuer une
      <a href="http://vosdroits.service-public.fr/particuliers/F17317.xhtml" target="_blank">demande de domiciliation</a>.
    </em></p>

    <div class="form-group">
      <label class="col-sm-4 control-label">Êtes-vous</label>
      <div class="col-sm-8">
        <button
          type="button"
          ng-repeat="logementType in logementTypes"
          class="btn btn-sm btn-primary"
          ng-model="situation.logement.type"
          btn-radio="logementType.id"
          popover-placement="top"
          popover="{{ logementType.helpText }}"
          popover-trigger="mouseenter">
          {{ logementType.label|uppercaseFirst }}
        </button>
      </div>
    </div>

    <div
      class="form-group"
      ng-if="situation.logement.type === 'locataire' || situation.logement.type === 'payant'">
      <label class="col-sm-4 control-label">Le propriétaire de votre logement est-il un membre de votre famille&nbsp;?</label>
      <div class="col-sm-8">
        <button type="button" class="btn btn-sm btn-primary" ng-model="situation.logement.membreFamilleProprietaire" btn-radio="true">Oui</button>
        <button type="button" class="btn btn-sm btn-primary" ng-model="situation.logement.membreFamilleProprietaire" btn-radio="false">Non</button>
      </div>
    </div>

    <div class="form-group" ng-show="situation.logement.type === 'locataire' && undefined !== situation.logement.membreFamilleProprietaire">
      <label class="col-sm-4 control-label">Quel type de logement louez-vous&nbsp;?</label>
      <div class="col-sm-6">
        <button
          type="button"
          class="btn btn-primary btn-sm"
          ng-repeat="locationType in locationTypes"
          ng-model="situation.logement.locationType"
          btn-radio="locationType.id">
          {{ locationType.label|uppercaseFirst }}
        </button>
      </div>
    </div>

    <div class="form-group" ng-show="situation.logement.type === 'proprietaire'">
      <label class="col-sm-4 control-label" popover="{{ primoAccedantTooltip }}" popover-trigger="mouseenter">
        Êtes-vous primo-accédant pour votre propriété&nbsp;?
      </label>
      <div class="col-sm-6">
        <button type="button" class="btn btn-sm btn-primary" ng-model="situation.logement.primoAccedant" btn-radio="true">Oui</button>
        <button type="button" class="btn btn-sm btn-primary" ng-model="situation.logement.primoAccedant" btn-radio="false">Non</button>
      </div>
    </div>

    <div class="form-group" ng-if="captureLoyer()" ng-class="{'has-error': submitted && form.loyer.$invalid}">
      <label class="col-sm-4 control-label" for="loyer">
        {{ loyerLabel() }}
      </label>
      <div class="col-sm-3">
        <div class="input-group">
          <input type="number" class="form-control text-right" id="loyer" name="loyer" ng-model="situation.logement.loyer" required>
          <div class="input-group-addon">€</div>
        </div>
        <span class="help-block" ng-if="submitted && form.loyer.$invalid">Champ invalide</span>
      </div>
      <div class="col-sm-5">
        <span class="help-block" ng-if="'proprietaire' === situation.logement.type"><em>Mettre 0 si vous n'avez pas d'emprunt pour votre propriété.</em></span>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-6">
        <div
          class="form-group"
          ng-show="captureCodePostal()"
          ng-class="{'has-error': submitted && unknownCodePostal}">
          <label class="col-sm-8 control-label" for="postal-code">Code postal de votre résidence</label>
          <div class="col-sm-4">
            <input
              type="text"
              class="form-control"
              id="postal-code"
              name="codePostal"
              required
              ng-model="situation.logement.adresse.codePostal"
              ng-change="updateCities()">
              <span class="help-block" ng-if="submitted && unknownCodePostal">Ce code postal est invalide</p>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <p class="form-control-static" ng-if="retrievingCities"><i class="fa fa-spinner fa-spin"></i></p>
        <select
          class="form-control"
          ng-if="cities.length"
          ng-options="city as city.nom for city in cities"
          ng-model="selectedCity">
        </select>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="submit" class="btn btn-primary" ng-if="captureCodePostal()">Valider</button>
  </div>
</form>
