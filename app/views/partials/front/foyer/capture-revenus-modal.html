<form name="form" class="form-horizontal" novalidate ng-submit="submit()">
  <div class="modal-header">
    <h1 class="modal-title">Revenus et aides</h1>
  </div>
  <div class="modal-body">
    <div ng-show="!ressourcesSelected">
      <p>
        Pour calculer les droits auxquels vous pouvez prétendre, nous avons besoin de connaître l'ensemble des revenus et aides que vous percevez.
        <br>Cliquez sur les types de revenus ou aides et sélectionnez les personnes qui les perçoivent.
        <br>Nous vous demanderons de préciser le montant de chaque type de revenu ou aide sélectionnés sur les 3 derniers mois dans l'écran suivant.
      </p>

      <accordion close-others="false">
        <accordion-group ng-repeat="section in sections" is-open="section.open">
          <accordion-heading>
            {{ section.label }}
            <i class="pull-right fa" ng-class="{'fa-chevron-down': section.open, 'fa-chevron-right': !section.open}"></i>
          </accordion-heading>
          <div ng-repeat="subsection in section.subsections">
            <button
              type="button"
              class="btn btn-sm btn-ressources"
              ng-class="'capture-' + section.name"
              btn-checkbox
              ng-model="selectedRessourcesMap[subsection.name]">
              {{ subsection.label }}
            </button>
            <span ng-if="selectedRessourcesMap[subsection.name]">
              Qui ?
              <label class="checkbox-inline" ng-repeat="individu in individus">
                <input type="checkbox" ng-model="selectedRessourcesByIndividu[individu.name][subsection.name]"> {{ individu.name }}
              </label>
            </span>
          </div>
        </accordion-group>
      </accordion>
    </div>

    <div ng-show="ressourcesSelected">
      <p>Veuillez entrer les montants des revenus ou aides sélectionné(e)s.</p>
      <div ng-repeat="individu in individus" ng-if="hasIndividuRevenus(individu)">
        <h2>{{ individu.name }}</h2>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th style="width: 200px;"></th>
              <th ng-repeat="month in months">{{ month.label | uppercaseFirst }}</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="subsectionName in orderedSelectedRessources[individu.name]" class="capture-{{ subsectionsIndex[subsectionName].section.name }}">
              <td style="width: 200px; vertical-align: middle; color: white;">{{ subsectionsIndex[subsectionName].label }}</td>
              <td ng-repeat="month in months">
                <span class="input-group">
                  <input type="number" class="form-control text-right" select-on-focus ng-model="individu.individu.ressources[subsectionName][month.id]">
                  <span class="input-group-addon hidden-xs">€</span>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" ng-show="ressourcesSelected" ng-click="$parent.ressourcesSelected = false">
      &lt; Sélectionner des revenus différents
    </button>
    <button type="submit" class="btn btn-primary">Valider</button>
  </div>
</form>
